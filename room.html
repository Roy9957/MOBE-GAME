<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MOBE 3D Lobby</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      overflow: hidden;
      touch-action: manipulation;
      -webkit-tap-highlight-color: transparent;
      font-family: 'Arial', sans-serif;
    }

    /* Add back button styles */
    #back-button {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 40px;
      height: 40px;
      background: rgba(10, 10, 30, 0.85);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 200;
      pointer-events: auto;
      border: 1px solid rgba(0, 247, 255, 0.4);
      box-shadow: 0 0 10px rgba(0, 247, 255, 0.3);
      backdrop-filter: blur(5px);
      transition: all 0.3s ease;
    }

    #back-button:hover {
      transform: scale(1.1);
      box-shadow: 0 0 15px rgba(0, 247, 255, 0.5);
    }

    #back-button::before {
      content: 'â‡œ';
      color: #00f7ff;
      font-size: 25px;
      text-shadow: 0 0 5px rgba(0, 247, 255, 0.7);
    }

    #ui-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      pointer-events: none;
      z-index: 100;
    }

    .ui-panel {
      background: rgba(10, 10, 30, 0.85);
      border-radius: 20px;
      padding: 30px;
      backdrop-filter: blur(12px);
      border: 1px solid rgba(0, 247, 255, 0.4);
      box-shadow: 
        0 0 30px rgba(0, 247, 255, 0.3),
        inset 0 0 15px rgba(0, 247, 255, 0.2);
      width: 90%;
      max-width: 420px;
      pointer-events: auto;
      transform: translateY(30px) scale(0.95);
      opacity: 0;
      transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .ui-panel.visible {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    h1 {
      color: #00f7ff;
      text-align: center;
      margin-bottom: 30px;
      font-size: 28px;
      text-shadow: 0 0 15px rgba(0, 247, 255, 0.7);
      letter-spacing: 2px;
      position: relative;
    }

    h1::after {
      content: '';
      position: absolute;
      bottom: -10px;
      left: 25%;
      width: 50%;
      height: 2px;
      background: linear-gradient(90deg, transparent, #00f7ff, transparent);
    }

    .input-group {
      margin-bottom: 25px;
      position: relative;
    }

    input {
      width: 100%;
      padding: 16px 20px;
      border: none;
      border-radius: 10px;
      background: rgba(30, 30, 50, 0.7);
      color: white;
      font-size: 16px;
      outline: none;
      border: 1px solid rgba(0, 247, 255, 0.3);
      transition: all 0.3s ease;
    }

    input:focus {
      border-color: #00f7ff;
      box-shadow: 0 0 15px rgba(0, 247, 255, 0.5);
    }

    .btn-group {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    button {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 10px;
      color: white;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      z-index: 1;
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, #0077ff, #00f7ff);
      z-index: -1;
      transition: all 0.3s ease;
    }

    button::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, #00f7ff, #0077ff);
      z-index: -2;
      transition: all 0.6s ease;
    }

    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 247, 255, 0.4);
    }

    button:hover::after {
      left: 100%;
    }

    button:active {
      transform: translateY(1px);
    }

    #create-btn {
      background: linear-gradient(45deg, #0077ff, #00f7ff);
    }

    #join-btn {
      background: linear-gradient(45deg, #ff00aa, #ff0066);
    }

    #join-btn::before {
      background: linear-gradient(45deg, #ff0066, #ff00aa);
    }

    #join-btn::after {
      background: linear-gradient(45deg, #ff00aa, #9900ff);
    }

    #error {
      color: #ff4444;
      text-align: center;
      font-size: 14px;
      min-height: 20px;
      margin-top: 15px;
      text-shadow: 0 0 5px rgba(255, 0, 0, 0.3);
    }

    @media (max-width: 480px) {
      .ui-panel {
        padding: 25px;
      }
      
      h1 {
        font-size: 24px;
      }
      
      input, button {
        padding: 14px;
      }
    }
  </style>
</head>
<body>
  <!-- Add back button -->
  <div id="back-button" title="Back to Lobby"></div>

  <div id="ui-container">
    <div class="ui-panel" id="main-panel">
      <h1>MOBE CUSTOM ROOM</h1>
      <div class="btn-group">
        <button id="create-btn">ðŸŽ® CREATE ROOM</button>
        <div class="input-group">
          <input type="text" id="room-id" placeholder="Enter Room ID" inputmode="text" autocapitalize="none" autocomplete="off">
        </div>
        <button id="join-btn">ðŸšª JOIN ROOM</button>
      </div>
      <div id="error"></div>
    </div>
  </div>

  <!-- Three.js and additional libraries -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/loaders/FontLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/geometries/TextGeometry.js"></script>
  
  <script>
    // Scene variables
    let scene, camera, renderer, controls;
    let logoMesh, particles = [];
    let clock = new THREE.Clock();
    let isMobileDevice = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    // Initialize the 3D scene
    initScene();
    animate();

    function initScene() {
      // Create scene
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x050510);
      scene.fog = new THREE.FogExp2(0x050510, 0.001);

      // Create camera
      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.z = 5;
      camera.position.y = 1;

      // Create renderer
      renderer = new THREE.WebGLRenderer({ 
        antialias: true,
        powerPreference: "high-performance"
      });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      renderer.shadowMap.enabled = true;
      document.body.appendChild(renderer.domElement);

      // Add orbit controls for desktop
      if (!isMobileDevice) {
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableZoom = false;
        controls.enablePan = false;
        controls.minPolarAngle = Math.PI / 4;
        controls.maxPolarAngle = Math.PI / 1.8;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.5;
      }

      // Lighting
      const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
      scene.add(ambientLight);

      const directionalLight = new THREE.DirectionalLight(0x00f7ff, 0.8);
      directionalLight.position.set(1, 1, 1);
      directionalLight.castShadow = true;
      scene.add(directionalLight);

      const pointLight = new THREE.PointLight(0xff00aa, 1, 20);
      pointLight.position.set(0, 3, 2);
      scene.add(pointLight);

      const hemiLight = new THREE.HemisphereLight(0x0077ff, 0x00f7ff, 0.3);
      scene.add(hemiLight);

      // Create room
      createRoom();

      // Create floating platforms
      createPlatforms();

      // Create stars
      createStars();

      // Create animated particles
      createParticles();

      // Load logo text
      loadLogo();

      // Handle window resize
      window.addEventListener('resize', onWindowResize);

      // Show UI after scene loads
      setTimeout(() => {
        document.getElementById('main-panel').classList.add('visible');
      }, 800);
    }

    function createRoom() {
      // Room floor
      const floorGeometry = new THREE.PlaneGeometry(30, 30);
      const floorMaterial = new THREE.MeshStandardMaterial({
        color: 0x101030,
        roughness: 0.8,
        metalness: 0.2,
        side: THREE.DoubleSide
      });
      const floor = new THREE.Mesh(floorGeometry, floorMaterial);
      floor.rotation.x = -Math.PI / 2;
      floor.position.y = -5;
      floor.receiveShadow = true;
      scene.add(floor);

      // Room walls (invisible but cast shadows)
      const wallGeometry = new THREE.BoxGeometry(30, 20, 0.1);
      const wallMaterial = new THREE.MeshStandardMaterial({
        color: 0x101030,
        transparent: true,
        opacity: 0.1,
        side: THREE.DoubleSide
      });

      const backWall = new THREE.Mesh(wallGeometry, wallMaterial);
      backWall.position.z = -15;
      scene.add(backWall);

      const leftWall = new THREE.Mesh(wallGeometry, wallMaterial);
      leftWall.rotation.y = Math.PI / 2;
      leftWall.position.x = -15;
      scene.add(leftWall);

      const rightWall = new THREE.Mesh(wallGeometry, wallMaterial);
      rightWall.rotation.y = Math.PI / 2;
      rightWall.position.x = 15;
      scene.add(rightWall);

      // Room wireframe
      const roomGeometry = new THREE.BoxGeometry(20, 10, 20);
      const edges = new THREE.EdgesGeometry(roomGeometry);
      const lineMaterial = new THREE.LineBasicMaterial({ 
        color: 0x00f7ff,
        transparent: true,
        opacity: 0.3
      });
      const wireframe = new THREE.LineSegments(edges, lineMaterial);
      scene.add(wireframe);
    }

    function createPlatforms() {
      const platformGeometry = new THREE.CylinderGeometry(2, 2, 0.2, 32);
      const platformMaterial = new THREE.MeshStandardMaterial({
        color: 0x0077ff,
        transparent: true,
        opacity: 0.7,
        metalness: 0.5,
        roughness: 0.2
      });

      for (let i = 0; i < 4; i++) {
        const angle = (i / 4) * Math.PI * 2;
        const platform = new THREE.Mesh(platformGeometry, platformMaterial);
        platform.position.set(
          Math.cos(angle) * 6,
          -2 + Math.sin(angle * 3) * 0.5,
          Math.sin(angle) * 6
        );
        platform.rotation.x = Math.PI / 2;
        platform.castShadow = true;
        platform.receiveShadow = true;
        scene.add(platform);
      }
    }

    function createStars() {
      const starGeometry = new THREE.BufferGeometry();
      const starMaterial = new THREE.PointsMaterial({
        color: 0xffffff,
        size: 1,
        transparent: true,
        opacity: 0.8
      });

      const starVertices = [];
      for (let i = 0; i < 10000; i++) {
        const x = (Math.random() - 0.5) * 2000;
        const y = (Math.random() - 0.5) * 2000;
        const z = (Math.random() - 0.5) * 2000;
        starVertices.push(x, y, z);
      }

      starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
      const stars = new THREE.Points(starGeometry, starMaterial);
      scene.add(stars);
    }

    function createParticles() {
      const particleCount = isMobileDevice ? 100 : 300;
      const particleGeometry = new THREE.BufferGeometry();
      const particleMaterial = new THREE.PointsMaterial({
        color: 0x00f7ff,
        size: 0.1,
        transparent: true,
        opacity: 0.8,
        blending: THREE.AdditiveBlending
      });

      const positions = new Float32Array(particleCount * 3);
      const sizes = new Float32Array(particleCount);
      const velocities = new Float32Array(particleCount * 3);

      for (let i = 0; i < particleCount; i++) {
        // Random positions in a sphere
        const radius = Math.random() * 5 + 5;
        const theta = Math.random() * Math.PI * 2;
        const phi = Math.random() * Math.PI;
        
        positions[i * 3] = radius * Math.sin(phi) * Math.cos(theta);
        positions[i * 3 + 1] = radius * Math.sin(phi) * Math.sin(theta);
        positions[i * 3 + 2] = radius * Math.cos(phi);
        
        sizes[i] = Math.random() * 0.2 + 0.1;
        
        // Random velocities
        velocities[i * 3] = (Math.random() - 0.5) * 0.02;
        velocities[i * 3 + 1] = (Math.random() - 0.5) * 0.02;
        velocities[i * 3 + 2] = (Math.random() - 0.5) * 0.02;
      }

      particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
      particleGeometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));
      
      const particleSystem = new THREE.Points(particleGeometry, particleMaterial);
      scene.add(particleSystem);

      // Store particles for animation
      particles.push({
        system: particleSystem,
        geometry: particleGeometry,
        velocities: velocities
      });
    }

    function loadLogo() {
      const fontLoader = new THREE.FontLoader();
      fontLoader.load('https://cdn.jsdelivr.net/npm/three@0.132.2/examples/fonts/helvetiker_regular.typeface.json', (font) => {
        const textGeometry = new THREE.TextGeometry('MOBE', {
          font: font,
          size: 0.8,
          height: 0.2,
          curveSegments: 12,
          bevelEnabled: true,
          bevelThickness: 0.03,
          bevelSize: 0.02,
          bevelOffset: 0,
          bevelSegments: 5
        });
        
        textGeometry.center();
        
        const textMaterial = new THREE.MeshPhongMaterial({
          color: 0x00f7ff,
          specular: 0xffffff,
          shininess: 100,
          emissive: 0x00aaff,
          emissiveIntensity: 0.3,
          flatShading: true
        });
        
        logoMesh = new THREE.Mesh(textGeometry, textMaterial);
        logoMesh.position.y = 1.5;
        logoMesh.castShadow = true;
        scene.add(logoMesh);
      });
    }

    function animate() {
      requestAnimationFrame(animate);
      
      const delta = clock.getDelta();
      const time = clock.getElapsedTime();
      
      // Animate particles
      particles.forEach(particle => {
        const positions = particle.geometry.attributes.position.array;
        for (let i = 0; i < positions.length; i += 3) {
          positions[i] += particle.velocities[i];
          positions[i + 1] += particle.velocities[i + 1];
          positions[i + 2] += particle.velocities[i + 2];
          
          // Boundary check
          const radius = Math.sqrt(
            positions[i] * positions[i] + 
            positions[i + 1] * positions[i + 1] + 
            positions[i + 2] * positions[i + 2]
          );
          
          if (radius > 10) {
            positions[i] = (Math.random() - 0.5) * 2;
            positions[i + 1] = (Math.random() - 0.5) * 2;
            positions[i + 2] = (Math.random() - 0.5) * 2;
          }
        }
        particle.geometry.attributes.position.needsUpdate = true;
      });
      
      // Animate logo
      if (logoMesh) {
        logoMesh.rotation.y = time * 0.2;
        logoMesh.position.y = 3.5 + Math.sin(time) * 0.2;
      }
      
      // Auto-rotate camera if controls exist
      if (controls) {
        controls.update();
      }
      
      renderer.render(scene, camera);
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    // Back button event handler
    document.getElementById('back-button').addEventListener('click', () => {
      window.location.href = "lobby.html";
    });

    // UI Event Handlers
    document.getElementById('create-btn').addEventListener('click', () => {
      window.location.href = "https://mobemulti.onrender.com/new";
    });

    document.getElementById('join-btn').addEventListener('click', async () => {
      const roomId = document.getElementById('room-id').value.trim();
      const errorElement = document.getElementById('error');
      errorElement.textContent = '';
      
      if (!roomId || roomId.length < 4) {
        errorElement.textContent = 'Room ID must be at least 4 characters';
        return;
      }
      
      try {
        const joinBtn = document.getElementById('join-btn');
        joinBtn.innerHTML = 'âŒ› CONNECTING...';
        
        const response = await fetch(`https://mobemulti.onrender.com/check?id=${roomId}`);
        const data = await response.json();
        
        if (data.exists) {
          joinBtn.innerHTML = 'âœ… JOINING...';
          setTimeout(() => {
            window.location.href = `https://mobemulti.onrender.com/play?id=${roomId}`;
          }, 500);
        } else {
          errorElement.textContent = 'Room not found. Please check the ID.';
          joinBtn.innerHTML = 'ðŸšª JOIN ROOM';
        }
      } catch (err) {
        errorElement.textContent = 'Connection error. Please try again.';
        document.getElementById('join-btn').innerHTML = 'ðŸšª JOIN ROOM';
        console.error(err);
      }
    });

    // Mobile keyboard fix
    document.getElementById('room-id').addEventListener('touchstart', function(e) {
      e.preventDefault();
      this.focus();
    }, { passive: false });
  </script>
</body>
</html>
